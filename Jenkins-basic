def gv
pipeline{
  agent any
  environment{
    NEW_VERSION = '1.0.0'
  }
  tools{
  maven 'Maven 3.9.6'
  }

  parameters{
      string(name: 'VERSION', defaultValue: 'New Version', description: 'Select the version to build')
    	//choice(name: 'VERSION', choices: ['1.0.0','1.0.1','1.0.3'], description: 'Select the version to build')
      booleanParam(name: 'executeTest', defaultValue: true, description: 'Execute Build')
  }
  stages{
      stage("init"){
        steps{
          script{
            gv = load "script.groovy"
          }
        }
      }
      stage("Testing"){
        steps{
          script{
            gv.testApp()
          }
          /*
          echo "Testing is running!"
          echo  "new version is ${NEW_VERSION}"
          sh "mvn --version" */
        }
      }
      stage("Building"){
        when {
            expression{
              params.executeTest == true
            }
          }
       steps{
          script{
            gv.buildApp()
          }
        }
      }
      stage("Deploying"){
        steps{
          script{
            gv.deployApp()
          }
        }
      }
  }

  post{
    always{
        echo "Default always!"
    }
    success{
        echo "Success"
    }
    failure{
        echo "failed"
    }
  }
}
